# Agent User Platform v0.2 - 工作流编排功能

## 🚀 概述

Agent User Platform v0.2 引入了强大的工作流编排功能，使用户能够通过可视化界面创建、编辑和执行复杂的多步骤AI工作流程。

## ✨ 新功能特性

### 1. 可视化工作流编辑器 (Story 4)

#### 核心功能
- **React Flow 画布集成**: 基于React Flow的可拖拽工作流编辑器
- **丰富的节点类型**: 支持输入、输出、Agent、条件分支等多种节点
- **直观的拖拽操作**: 流畅的节点拖拽和连线体验
- **实时预览**: 工作流结构的实时可视化展示
- **撤销/重做支持**: 完整的操作历史管理

#### 节点类型
- **输入节点 (Input)**: 接收用户输入数据
  - 支持文本、文件、JSON、URL等多种输入类型
  - 可配置默认值和必填验证
- **输出节点 (Output)**: 输出工作流结果
  - 支持文本、文件、JSON、表格等多种输出格式
  - 可自定义输出格式和样式
- **Agent节点 (Agent)**: AI智能体处理节点
  - 集成v0.1的Agent功能
  - 支持模型选择、参数配置、工具选择
- **条件节点 (Condition)**: 逻辑分支控制
  - 支持if/else条件判断
  - 支持多分支switch语句
  - 支持循环控制

### 2. LangGraph执行引擎 (Story 5)

#### 核心功能
- **LangGraph集成**: 基于LangGraph的工作流执行引擎
- **多种执行模式**: 支持顺序执行、并行执行、条件执行
- **状态管理**: 完整的执行状态跟踪和管理
- **错误处理**: 完善的异常捕获和错误恢复机制

#### 执行特性
- **异步执行**: 非阻塞的工作流执行
- **实时状态更新**: 执行进度的实时监控
- **节点级日志**: 详细的节点执行日志
- **执行历史**: 完整的执行记录和回放功能

### 3. 工作流调试与预览 (Story 6)

#### 调试功能
- **工作流验证**: 自动检查工作流结构的正确性
- **模拟执行**: 无需真实执行即可预览工作流逻辑
- **断点调试**: 支持在特定节点设置断点
- **单步执行**: 逐步执行工作流进行调试

#### 预览功能
- **数据流可视化**: 显示数据在工作流中的流动路径
- **节点状态监控**: 实时显示每个节点的执行状态
- **结果预览**: 预览每个节点的输出结果
- **性能分析**: 节点执行时间和资源使用统计

## 🛠️ 技术实现

### 前端技术栈
- **React Flow**: 可视化工作流编辑器
- **Zustand**: 工作流状态管理
- **TypeScript**: 类型安全的开发体验
- **Tailwind CSS**: 现代化的UI样式

### 后端技术栈
- **FastAPI**: 高性能的API框架
- **LangGraph**: 工作流执行引擎
- **Pydantic**: 数据验证和序列化
- **JSON文件存储**: 简单可靠的数据持久化

### 新增依赖
```json
{
  "dependencies": {
    "reactflow": "^11.11.4",
    "zustand": "^5.0.8",
    "uuid": "^13.0.0",
    "@types/uuid": "^10.0.0"
  }
}
```

## 📁 项目结构

### 前端结构
```
frontend/src/
├── components/
│   ├── workflow/          # 工作流相关组件
│   │   ├── AgentNode.tsx      # Agent节点组件
│   │   ├── InputNode.tsx      # 输入节点组件
│   │   ├── OutputNode.tsx     # 输出节点组件
│   │   └── ConditionNode.tsx  # 条件节点组件
│   └── ui/               # UI基础组件
├── hooks/
│   └── useWorkflow.ts    # 工作流状态管理
├── pages/
│   └── WorkflowEditor.tsx # 工作流编辑器页面
├── services/
│   └── workflowApi.ts    # 工作流API服务
└── types/
    └── workflow.ts       # 工作流类型定义
```

### 后端结构
```
backend/
├── workflow_service.py   # 工作流业务逻辑
├── workflow_routes.py    # 工作流API路由
└── test_workflows.py     # 工作流测试用例
```

## 🔧 API接口

### 工作流管理API
- `GET /api/workflows/` - 获取用户工作流列表
- `POST /api/workflows/` - 创建工作流
- `GET /api/workflows/{id}` - 获取特定工作流
- `PUT /api/workflows/{id}` - 更新工作流
- `DELETE /api/workflows/{id}` - 删除工作流

### 工作流执行API
- `POST /api/workflows/execute` - 执行工作流
- `GET /api/workflows/executions/{id}` - 获取执行状态
- `GET /api/workflows/executions` - 获取执行历史

### 工作流工具API
- `POST /api/workflows/validate` - 验证工作流
- `GET /api/workflows/templates` - 获取工作流模板
- `POST /api/workflows/from-template` - 从模板创建工作流
- `GET /api/workflows/{id}/export` - 导出工作流
- `POST /api/workflows/import` - 导入工作流

## 🎯 使用示例

### 创建工作流
```typescript
const workflow = {
  name: "文档分析工作流",
  description: "自动分析文档内容并生成摘要",
  nodes: [
    {
      id: "input-1",
      type: "input",
      position: { x: 100, y: 100 },
      data: {
        label: "文档输入",
        input_type: "file",
        accepted_formats: [".pdf", ".doc", ".txt"]
      }
    },
    {
      id: "agent-1",
      type: "agent",
      position: { x: 300, y: 100 },
      data: {
        label: "文档分析Agent",
        agent_config: {
          model: "llama2",
          temperature: 0.3,
          max_tokens: 2000,
          system_prompt: "你是一个专业的文档分析助手..."
        }
      }
    },
    {
      id: "output-1",
      type: "output",
      position: { x: 500, y: 100 },
      data: {
        label: "分析结果",
        output_type: "json",
        format: "structured"
      }
    }
  ],
  edges: [
    {
      id: "edge-1",
      source: "input-1",
      target: "agent-1"
    },
    {
      id: "edge-2",
      source: "agent-1",
      target: "output-1"
    }
  ]
};

const createdWorkflow = await workflowAPI.createWorkflow(workflow);
```

### 执行工作流
```typescript
const execution = await workflowAPI.executeWorkflow({
  workflow_id: createdWorkflow.id,
  input_data: {
    "input-1": {
      file_path: "/path/to/document.pdf"
    }
  },
  dry_run: false
});
```

## 🧪 测试覆盖

### 单元测试
- 工作流CRUD操作测试
- 工作流验证逻辑测试
- 工作流执行测试
- 权限控制测试

### 集成测试
- 端到端工作流创建和执行
- 多节点复杂工作流测试
- 错误处理和恢复测试

## 📊 性能指标

### 验收标准
- ✅ 支持5种以上节点类型
- ✅ 拖拽操作响应流畅（<100ms）
- ✅ 支持撤销/重做功能
- ✅ 支持工作流保存/加载
- ✅ 支持顺序/并行/条件执行
- ✅ 支持10节点以上复杂工作流
- ✅ 执行错误可追踪定位
- ✅ 支持执行中断/恢复

### 性能目标
- 工作流加载时间: ≤2秒
- 节点拖拽响应: ≤100ms
- 工作流执行启动: ≤1秒
- 执行状态更新: 实时
- 内存使用: ≤500MB（100节点工作流）

## 🔮 未来规划

### v0.3 计划
- **LangStudio集成**: 与LangStudio的双向同步
- **高级调试功能**: 更强大的调试和性能分析工具
- **协作功能**: 多用户协作编辑工作流

### v0.4 计划
- **WeKnora集成**: 知识库集成和智能检索
- **企业级功能**: 权限管理、审计日志
- **云部署**: 支持云端部署和扩展

## 📞 支持

如有使用问题，请通过以下方式联系：
- GitHub Issues
- 邮箱: support@agentuser.com
- 文档: https://docs.agentuser.com

## 📝 许可证

MIT License

---

**版本**: v0.2.0
**发布日期**: 2024年
**兼容性**: 前端 React 19+ / 后端 Python 3.8+